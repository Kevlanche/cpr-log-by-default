<!DOCTYPE html>
<html>
<head>
  <title>Minimal Editor</title>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

  <script>
    function getCompletions() { }
    window.definedEditors = {};
    function defineEditor(
      id,
      preload,
      init,
    ) {
      definedEditors[id] = { preload, init };
    }
    window.definedModules = {};
    window.define = (moduleName, reqs, loader) => { definedModules[moduleName] = { reqs, loader }; };
  </script>
  <link rel="stylesheet" href="style.css" />
  <script src="editor-monaco.js"></script>
  <script src="ts/main.js"></script>

  <script>
    function toggleLezer(){}
    function onParserChanged(){}

    function loadPreload(prel, onDone) {
      const { script = [], style = [], predicate } = prel();

      const createNode = (type, src, then) => {
        const ret = document.createElement(type);
        if (type == 'link') {
          ret.rel = 'stylesheet';
          ret.href = src;
        } else {
          ret.src = src;
          ret.onload = then;
        }
        document.head.appendChild(ret);
      }
      style.forEach(s => createNode('link', s));

      function loadScriptsSequentially(idx) {
        if (idx >= script.length) {
          const poller = setInterval(() => {
            if (predicate()) {
              clearInterval(poller);
              onDone();
            }
          }, 10);
        } else {
          createNode('script', script[idx], () => loadScriptsSequentially(idx + 1));
        }
      }
      // Some scripts depend on being loaded after each other.
      // This happens "automatically" when put into the <head> natively
      // When loading dynamically like this, we need this sequential code to make it work.
      loadScriptsSequentially(0);

      if (window.location.search.includes('fullscreen=true')) {
        document.body.classList.add('fullscreen');
      }
      if (window.location.search.includes('hideModals=true')) {
        document.body.classList.add('hideModals');
      }
    }
  </script>

</head>
<script>
  const loadedModules = {
    require: () => { throw new Error("TODO implement require if needed"); },
  };
  function loadModule(moduleName) {
    if (loadedModules[moduleName]) {
      return loadedModules[moduleName];
    }
    const moduleExports = loadedModules[moduleName] = { __esModule: true };
    const { reqs, loader } = definedModules[moduleName];
    loader(...reqs.map(req => req === 'exports' ? moduleExports : loadModule(req)))
    return moduleExports;
  }
  loadModule('main');
  window.MiniEditorMain();
</script>

<body onload="maybeAutoInit()" data-theme-light="false">
  <div id="connections">
    <p>Pick an editor</p>
    <button onclick="init('Monaco')">Monaco</button>
  </div>
  <div id="root" style="display: none;">
    <span id="input-header">
      Input
    </span>
    <span id="settings-header">
      Settings
    </span>
    <div id="input-wrapper" style="width: 100%;">
      <textarea id="input" style="width: 48vw;"></textarea>
    </div>
    <div id="control-panel">
      <div>
        <input type='checkbox' id='control-dark-mode' checked></input>
        <label for='control-dark-mode'>Dark mode</label>
      </div>
      <div>
        <input type='checkbox' id='control-capture-stdout'></input>
        <label for='control-capture-stdout'>Capture stdio</label>
      </div>
      <div>
        <input type='checkbox' id='control-duplicate-probe-on-attr' checked></input>
        <label for='control-duplicate-probe-on-attr'>Duplicate probe on attr click</label>
      </div>
      <div>
        <select id="control-position-recovery-strategy">
          <option value="FAIL">Fail</option>
          <option value="SEQUENCE_PARENT_CHILD">Parent->Child</option>
          <option value="SEQUENCE_CHILD_PARENT">Child->Parent</option>
          <option value="PARENT">Parent only</option>
          <option value="CHILD">Child only</option>
          <option value="ALTERNATE_PARENT_CHILD" >Zigzag</option>
        </select>
        <label for='control-position-recovery-strategy'>Position recovery strategy</label>
        <button onClick="displayRecoveryStrategyHelp()" id="control-position-recovery-strategy-help" style="border-radius: 50%; ">?</button>
      </div>
      <button id="display-help" onclick="displayGeneralHelp()">Help</button>
      <button id="clear-settings" onclick="clearPastaSettings()">Clear state and reload</button>
      <br>
      <div id="secret-debug-panel" style="display: none; border-top: 2px dashed gray; margin-top: 2rem; padding: 0.25rem 0;">
        <button id="display-statistics" onclick="displayProbeStatistics()">Statistics</button>
      </div>
    </div>
  </div>
</body>
<script>
</script>

</html>
